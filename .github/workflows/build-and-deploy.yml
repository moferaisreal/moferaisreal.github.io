name: Build Selected Projects and Deploy

on:
  push:
    branches: [main]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: ðŸ—ï¸ Build Selected Projects
        run: |
          # Criar pasta para reunir todos os builds
          mkdir -p _site

          # ============================================
          # ðŸŽ¯ PROJETOS QUE VOCÃŠ QUER BUILDAR
          # ============================================

          # EXERCICIO_GRUNT (com build)
          if [ -d "exercicio_grunt" ]; then
            echo "ðŸ”¨ Building exercicio_grunt..."
            cd exercicio_grunt
            if [ -f "package.json" ]; then
              npm install
              npx grunt build || npx grunt || true
            fi
            # Copia TUDO da pasta dist para _site/exercicio_grunt
            if [ -d "dist" ]; then
              cp -r dist/ "../_site/exercicio_grunt"
            fi
            cd ..
          fi

          # EXERCICIO_GULP (com build)
          if [ -d "exercicio_gulp" ]; then
            echo "ðŸ”¨ Building exercicio_gulp..."
            cd exercicio_gulp
            if [ -f "package.json" ]; then
              npm install
              npx gulp build || npx gulp || true
            fi
            # Copia TUDO da pasta dist para _site/exercicio_gulp
            if [ -d "dist" ]; then
              cp -r dist/ "../_site/exercicio_gulp"
            fi
            cd ..
          fi

          # ============================================
          # ðŸ“ PROJETOS SEM BUILD (cÃ³pia direta)
          # ============================================

          # Adicione aqui os projetos que vocÃª quer incluir SEM build
          for project in "JogoVolei" "projeto_03" "exercicio_sass" "exercicio-modulo-12" "exercicio-modulo-8" "exercicio_css" "exercicio_html_js" "exercicio_modulo_10" "exercicio_modulo_11" "exercicio_modulo_13" "exercicio_sass" "exericio_modulo_jquery" "modulo5_projeto1_entrega" "plugins_jquery" "projeto_01" "projeto_02" ; do
            if [ -d "$project" ]; then
              echo "ðŸ“ Copying $project..."
              cp -r "$project" "_site/"
            fi
          done

          # ============================================
          # ðŸ  ARQUIVOS DA RAIZ
          # ============================================

          # Copiar index.html e outros arquivos da raiz
          cp -f *.html _site/ 2>/dev/null || true
          cp -rf images _site/ 2>/dev/null || true
          cp -rf css _site/ 2>/dev/null || true
          cp -rf js _site/ 2>/dev/null || true
          cp -f *.js _site/ 2>/dev/null || true

      - name: ðŸš€ Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        if: github.ref == 'refs/heads/main'
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./_site
          force_orphan: true

          ## Adicione o nome na lista da seÃ§Ã£o "PROJETOS SEM BUILD"
# for project in "JogoVolei" "projeto_03" "exercicio_sass" "SEU_NOVO_PROJETO"; do
# Adicione este bloco na seÃ§Ã£o "PROJETOS QUE VOCÃŠ QUER BUILDAR"
#if [ -d "nome_do_projeto" ]; then
#  echo "ðŸ”¨ Building nome_do_projeto..."
#  cd nome_do_projeto
#  if [ -f "package.json" ]; then
#    npm install
#    npx grunt build || npx gulp build || true  # escolha grunt OU gulp
#  fi
#  if [ -d "dist" ]; then
#    cp -r dist/ "../_site/nome_do_projeto"
#  fi
#  cd ..
#fi
